{"version":3,"file":"SMS.vue_vue_type_script_setup_true_lang--XJrtie6.js","sources":["../../src/views/Vadmin/System/Settings/components/SMS.vue"],"sourcesContent":["<script setup lang=\"tsx\">\nimport { Form, FormSchema } from '@/components/Form'\nimport { useForm } from '@/hooks/web/useForm'\nimport { getSystemSettingsApi, putSystemSettingsApi } from '@/api/vadmin/system/settings'\nimport { reactive, ref } from 'vue'\nimport { ElMessage } from 'element-plus'\nimport { propTypes } from '@/utils/propTypes'\nimport { useValidator } from '@/hooks/web/useValidator'\nimport { BaseButton } from '@/components/Button'\n\nconst { required } = useValidator()\n\nconst props = defineProps({\n  tabId: propTypes.number\n})\n\nconst formSchema = reactive<FormSchema[]>([\n  {\n    field: 'sms_access_key',\n    label: 'AccessKey',\n    colProps: {\n      span: 24\n    },\n    component: 'Input',\n    componentProps: {\n      style: {\n        width: '500px'\n      }\n    }\n  },\n  {\n    field: 'sms_access_key_secret',\n    label: 'AccessKeySecret',\n    colProps: {\n      span: 24\n    },\n    component: 'Input',\n    componentProps: {\n      style: {\n        width: '500px'\n      }\n    }\n  },\n  {\n    field: 'sms_sign_name_1',\n    label: '短信验证码签名',\n    colProps: {\n      span: 24\n    },\n    component: 'Input',\n    componentProps: {\n      style: {\n        width: '500px'\n      }\n    }\n  },\n  {\n    field: 'sms_template_code_1',\n    label: '短信验证码模板',\n    colProps: {\n      span: 24\n    },\n    component: 'Input',\n    componentProps: {\n      style: {\n        width: '500px'\n      }\n    }\n  },\n  {\n    field: 'sms_sign_name_2',\n    label: '重置密码签名',\n    colProps: {\n      span: 24\n    },\n    component: 'Input',\n    componentProps: {\n      style: {\n        width: '500px'\n      }\n    }\n  },\n  {\n    field: 'sms_template_code_2',\n    label: '重置密码模板',\n    colProps: {\n      span: 24\n    },\n    component: 'Input',\n    componentProps: {\n      style: {\n        width: '500px'\n      }\n    }\n  },\n  {\n    field: 'sms_send_interval',\n    label: '发送频率',\n    colProps: {\n      span: 24\n    },\n    component: 'Input',\n    componentProps: {\n      style: {\n        width: '500px'\n      }\n    }\n  },\n  {\n    field: 'sms_valid_time',\n    label: '有效时间',\n    colProps: {\n      span: 24\n    },\n    component: 'Input',\n    componentProps: {\n      style: {\n        width: '500px'\n      }\n    }\n  },\n  {\n    field: 'active',\n    label: '',\n    colProps: {\n      span: 24\n    },\n    formItemProps: {\n      slots: {\n        default: () => {\n          return (\n            <>\n              <BaseButton loading={loading.value} type=\"primary\" onClick={save}>\n                立即提交\n              </BaseButton>\n            </>\n          )\n        }\n      }\n    }\n  }\n])\n\nconst rules = reactive({\n  sms_access_key: [required()],\n  sms_access_key_secret: [required()],\n  sms_send_interval: [required()],\n  sms_valid_time: [required()]\n})\n\nconst { formRegister, formMethods } = useForm()\nconst { setValues, getFormData, getElFormExpose } = formMethods\n\nlet formData = ref({} as Recordable)\n\nconst getData = async () => {\n  const res = await getSystemSettingsApi({ tab_id: props.tabId })\n  if (res) {\n    await setValues(res.data)\n    formData.value = res.data\n    const elForm = await getElFormExpose()\n    elForm?.clearValidate()\n  }\n}\n\nconst loading = ref(false)\n\nconst save = async () => {\n  const elForm = await getElFormExpose()\n  const valid = await elForm?.validate()\n  if (valid) {\n    const formData = await getFormData()\n    loading.value = true\n    if (!formData) {\n      loading.value = false\n      return ElMessage.error('未获取到数据')\n    }\n    try {\n      const res = await putSystemSettingsApi(formData)\n      if (res) {\n        getData()\n        return ElMessage.success('更新成功')\n      }\n    } finally {\n      loading.value = false\n    }\n  }\n}\n\ngetData()\n</script>\n\n<template>\n  <Form :rules=\"rules\" @register=\"formRegister\" :schema=\"formSchema\" />\n</template>\n\n<style lang=\"less\"></style>\n"],"names":["required","useValidator","props","__props","formSchema","reactive","field","label","colProps","span","component","componentProps","style","width","formItemProps","slots","default","_createVNode","_Fragment","BaseButton","loading","value","save","_createTextVNode","rules","sms_access_key","sms_access_key_secret","sms_send_interval","sms_valid_time","formRegister","formMethods","useForm","setValues","getFormData","getElFormExpose","formData","ref","getData","__async","res","getSystemSettingsApi","tab_id","tabId","data","elForm","clearValidate","validate","ElMessage","error","putSystemSettingsApi","success"],"mappings":"ujBAUA,KAAM,CAAEA,SAAAA,CAAU,EAAGC,EAAY,EAE3BC,EAAQC,EAIRC,EAAaC,EAAuB,CACxC,CACEC,MAAO,iBACPC,MAAO,YACPC,SAAU,CACRC,KAAM,EACP,EACDC,UAAW,QACXC,eAAgB,CACdC,MAAO,CACLC,MAAO,OACT,CACF,CACF,EACA,CACEP,MAAO,wBACPC,MAAO,kBACPC,SAAU,CACRC,KAAM,EACP,EACDC,UAAW,QACXC,eAAgB,CACdC,MAAO,CACLC,MAAO,OACT,CACF,CACF,EACA,CACEP,MAAO,kBACPC,MAAO,UACPC,SAAU,CACRC,KAAM,EACP,EACDC,UAAW,QACXC,eAAgB,CACdC,MAAO,CACLC,MAAO,OACT,CACF,CACF,EACA,CACEP,MAAO,sBACPC,MAAO,UACPC,SAAU,CACRC,KAAM,EACP,EACDC,UAAW,QACXC,eAAgB,CACdC,MAAO,CACLC,MAAO,OACT,CACF,CACF,EACA,CACEP,MAAO,kBACPC,MAAO,SACPC,SAAU,CACRC,KAAM,EACP,EACDC,UAAW,QACXC,eAAgB,CACdC,MAAO,CACLC,MAAO,OACT,CACF,CACF,EACA,CACEP,MAAO,sBACPC,MAAO,SACPC,SAAU,CACRC,KAAM,EACP,EACDC,UAAW,QACXC,eAAgB,CACdC,MAAO,CACLC,MAAO,OACT,CACF,CACF,EACA,CACEP,MAAO,oBACPC,MAAO,OACPC,SAAU,CACRC,KAAM,EACP,EACDC,UAAW,QACXC,eAAgB,CACdC,MAAO,CACLC,MAAO,OACT,CACF,CACF,EACA,CACEP,MAAO,iBACPC,MAAO,OACPC,SAAU,CACRC,KAAM,EACP,EACDC,UAAW,QACXC,eAAgB,CACdC,MAAO,CACLC,MAAO,OACT,CACF,CACF,EACA,CACEP,MAAO,SACPC,MAAO,GACPC,SAAU,CACRC,KAAM,EACP,EACDK,cAAe,CACbC,MAAO,CACLC,QAASA,IACPC,EAAAC,EAAAD,KAAAA,CAAAA,EAAAE,EAAA,CAAA,QAEyBC,EAAQC,MAAK,KAAA,UAAA,QAA0BC,CAAI,EAAA,CAAAN,QAAAA,IAAA,CAAAO,EAAA,MAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAMxE,CACF,CACD,CAAA,CACF,EAEKC,EAAQnB,EAAS,CACrBoB,eAAgB,CAACzB,GAAU,EAC3B0B,sBAAuB,CAAC1B,GAAU,EAClC2B,kBAAmB,CAAC3B,GAAU,EAC9B4B,eAAgB,CAAC5B,GAAU,CAC7B,CAAC,EAEK,CAAE6B,aAAAA,EAAcC,YAAAA,CAAa,EAAGC,EAAO,EACvC,CAAEC,UAAAA,EAAWC,YAAAA,EAAaC,gBAAAA,CAAiB,EAAGJ,EAEpD,IAAIK,EAAWC,EAAI,CAAA,CAAgB,EAEnC,MAAMC,EAAU,IAAYC,EAAA,sBAC1B,MAAMC,EAAM,MAAMC,EAAqB,CAAEC,OAAQvC,EAAMwC,KAAM,CAAC,EAC9D,GAAIH,EAAK,CACP,MAAMP,EAAUO,EAAII,IAAI,EACxBR,EAASd,MAAQkB,EAAII,KACrB,MAAMC,EAAS,MAAMV,IACrBU,GAAAA,MAAAA,EAAQC,eACV,IAGIzB,EAAUgB,EAAI,EAAK,EAEnBd,EAAO,IAAYgB,EAAA,sBACvB,MAAMM,EAAS,MAAMV,IAErB,GADc,MAAMU,GAAAA,YAAAA,EAAQE,WACjB,CACT,MAAMX,EAAW,MAAMF,IAEvB,GADAb,EAAQC,MAAQ,GACZ,CAACc,EACHf,OAAAA,EAAQC,MAAQ,GACT0B,EAAUC,MAAM,QAAQ,EAEjC,GAAI,CAEF,GADY,MAAMC,EAAqBd,CAAQ,EAE7CE,OAAAA,IACOU,EAAUG,QAAQ,MAAM,CAEnC,QAAU,CACR9B,EAAQC,MAAQ,EAClB,CACF,IAGFgB,OAAAA"}