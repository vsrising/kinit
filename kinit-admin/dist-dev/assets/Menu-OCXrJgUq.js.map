{"version":3,"file":"Menu-OCXrJgUq.js","sources":["../../src/views/Vadmin/Auth/Menu/Menu.vue"],"sourcesContent":["<script setup lang=\"tsx\">\nimport { reactive, ref, unref } from 'vue'\nimport {\n  getMenuListApi,\n  delMenuListApi,\n  addMenuListApi,\n  putMenuListApi\n} from '@/api/vadmin/auth/menu'\nimport { useTable } from '@/hooks/web/useTable'\nimport { useI18n } from '@/hooks/web/useI18n'\nimport { Table, TableColumn } from '@/components/Table'\nimport { ElSwitch, ElRow, ElCol } from 'element-plus'\nimport { Icon } from '@/components/Icon'\nimport { ContentWrap } from '@/components/ContentWrap'\nimport Write from './components/Write.vue'\nimport { Dialog } from '@/components/Dialog'\nimport { useDictStore } from '@/store/modules/dict'\nimport { selectDictLabel, DictDetail } from '@/utils/dict'\nimport { BaseButton } from '@/components/Button'\n\ndefineOptions({\n  name: 'AuthMenu'\n})\n\nconst { t } = useI18n()\n\nconst { tableRegister, tableState, tableMethods } = useTable({\n  fetchDataApi: async () => {\n    const { pageSize, currentPage } = tableState\n    const res = await getMenuListApi({\n      page: unref(currentPage),\n      limit: unref(pageSize)\n    })\n    return {\n      list: res.data || [],\n      total: res.count || 0\n    }\n  },\n  fetchDelApi: async (value) => {\n    const res = await delMenuListApi(value)\n    return res.code === 200\n  }\n})\n\nconst { dataList, loading } = tableState\nconst { getList, delList } = tableMethods\n\nlet menuTypeOptions = ref<DictDetail[]>([])\n\nconst getOptions = async () => {\n  const dictStore = useDictStore()\n  const dictOptions = await dictStore.getDictObj(['sys_vadmin_menu_type'])\n  menuTypeOptions.value = dictOptions.sys_vadmin_menu_type\n}\n\ngetOptions()\n\nconst tableColumns = reactive<TableColumn[]>([\n  {\n    field: 'title',\n    label: '菜单名称',\n    width: '200px',\n    disabled: true,\n    show: true\n  },\n  {\n    field: 'icon',\n    label: '图标',\n    width: '120px',\n    show: false,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return <>{row.icon ? <Icon icon={row.icon} /> : ''}</>\n      }\n    }\n  },\n  {\n    field: 'order',\n    label: '排序',\n    width: '120px',\n    show: true\n  },\n  {\n    field: 'menu_type',\n    label: '菜单类型',\n    width: '120px',\n    show: true,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return (\n          <>\n            <span>{selectDictLabel(menuTypeOptions.value, row.menu_type)}</span>\n          </>\n        )\n      }\n    }\n  },\n  {\n    field: 'perms',\n    label: '权限标识',\n    width: '150px',\n    show: true\n  },\n  {\n    field: 'path',\n    label: '路由地址',\n    show: true\n  },\n  {\n    field: 'component',\n    label: '组件路径',\n    show: true\n  },\n  {\n    field: 'noCache',\n    label: '页面缓存',\n    width: '120px',\n    show: true,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return (\n          <>\n            <ElSwitch modelValue={!row.noCache} disabled />\n          </>\n        )\n      }\n    }\n  },\n  {\n    field: 'hidden',\n    label: '显示状态',\n    width: '120px',\n    show: true,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return (\n          <>\n            <ElSwitch modelValue={!row.hidden} disabled />\n          </>\n        )\n      }\n    }\n  },\n  {\n    field: 'disabled',\n    label: '菜单状态',\n    width: '120px',\n    show: true,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return (\n          <>\n            <ElSwitch modelValue={!row.disabled} disabled />\n          </>\n        )\n      }\n    }\n  },\n  {\n    field: 'action',\n    width: '200px',\n    label: '操作',\n    show: true,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        const update = ['auth.menu.update']\n        const add = ['auth.menu.create']\n        const del = ['auth.menu.delete']\n        return (\n          <>\n            <BaseButton\n              type=\"primary\"\n              v-hasPermi={update}\n              link\n              size=\"small\"\n              onClick={() => editAction(row)}\n            >\n              编辑\n            </BaseButton>\n            <BaseButton\n              type=\"primary\"\n              v-hasPermi={add}\n              link\n              size=\"small\"\n              onClick={() => addSonAction(row)}\n            >\n              添加子菜单\n            </BaseButton>\n            <BaseButton\n              type=\"danger\"\n              v-hasPermi={del}\n              loading={delLoading.value}\n              link\n              size=\"small\"\n              onClick={() => delData(row)}\n            >\n              删除\n            </BaseButton>\n          </>\n        )\n      }\n    }\n  }\n])\n\nconst delLoading = ref(false)\n\nconst delData = async (row: any) => {\n  delLoading.value = true\n  await delList(true, [row.id]).finally(() => {\n    delLoading.value = false\n  })\n}\n\nconst dialogVisible = ref(false)\nconst dialogTitle = ref('')\n\nconst currentRow = ref()\nconst parentId = ref(undefined)\nconst actionType = ref('')\n\nconst writeRef = ref<ComponentRef<typeof Write>>()\n\nconst saveLoading = ref(false)\n\nconst editAction = (row: any) => {\n  dialogTitle.value = '编辑'\n  actionType.value = 'edit'\n  currentRow.value = row\n  dialogVisible.value = true\n}\n\nconst addAction = () => {\n  dialogTitle.value = '新增'\n  actionType.value = 'add'\n  currentRow.value = undefined\n  dialogVisible.value = true\n}\n\nconst addSonAction = (row: any) => {\n  dialogTitle.value = '添加子菜单'\n  actionType.value = 'addSon'\n  parentId.value = row.id\n  currentRow.value = undefined\n  dialogVisible.value = true\n}\n\nconst save = async () => {\n  const write = unref(writeRef)\n  const formData = await write?.submit()\n  if (formData) {\n    saveLoading.value = true\n    try {\n      const res = ref({})\n      if (actionType.value === 'add' || actionType.value === 'addSon') {\n        res.value = await addMenuListApi(formData)\n        if (res.value) {\n          parentId.value = undefined\n          dialogVisible.value = false\n          getList()\n        }\n      } else if (actionType.value === 'edit') {\n        res.value = await putMenuListApi(formData)\n        if (res.value) {\n          dialogVisible.value = false\n          getList()\n        }\n      }\n    } finally {\n      saveLoading.value = false\n    }\n  }\n}\n</script>\n\n<template>\n  <ContentWrap>\n    <Table\n      :columns=\"tableColumns\"\n      showAction\n      default-expand-all\n      node-key=\"id\"\n      :data=\"dataList\"\n      :loading=\"loading\"\n      @register=\"tableRegister\"\n      @refresh=\"getList\"\n    >\n      <template #toolbar>\n        <ElRow :gutter=\"10\">\n          <ElCol :span=\"1.5\">\n            <BaseButton type=\"primary\" v-hasPermi=\"['auth.menu.create']\" @click=\"addAction\"\n              >新增菜单</BaseButton\n            >\n          </ElCol>\n        </ElRow>\n      </template>\n    </Table>\n  </ContentWrap>\n\n  <Dialog v-model=\"dialogVisible\" :title=\"dialogTitle\">\n    <Write ref=\"writeRef\" :current-row=\"currentRow\" :parent-id=\"parentId\" />\n\n    <template #footer>\n      <BaseButton\n        v-if=\"actionType !== 'detail'\"\n        type=\"primary\"\n        :loading=\"saveLoading\"\n        @click=\"save\"\n      >\n        {{ t('exampleDemo.save') }}\n      </BaseButton>\n      <BaseButton @click=\"dialogVisible = false\">{{ t('dialogDemo.close') }}</BaseButton>\n    </template>\n  </Dialog>\n</template>\n"],"names":["t","useI18n","tableRegister","tableState","tableMethods","useTable","fetchDataApi","__async","pageSize","currentPage","res","getMenuListApi","page","unref","limit","list","data","total","count","fetchDelApi","value","delMenuListApi","code","dataList","loading","getList","delList","menuTypeOptions","ref","dictOptions","useDictStore","getDictObj","sys_vadmin_menu_type","tableColumns","reactive","field","label","width","disabled","show","slots","default","row","_createVNode2","_Fragment2","icon","Icon","selectDictLabel","menu_type","ElSwitch","noCache","hidden","update","add","del","_withDirectives2","BaseButton","onClick","editAction","_createTextVNode2","_resolveDirective2","addSonAction","delLoading","delData","id","finally","dialogVisible","dialogTitle","currentRow","parentId","undefined","actionType","writeRef","saveLoading","addAction","save","write","formData","submit","addMenuListApi","putMenuListApi"],"mappings":"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"}