var P=(d,f,u)=>new Promise((v,p)=>{var g=t=>{try{i(u.next(t))}catch(c){p(c)}},x=t=>{try{i(u.throw(t))}catch(c){p(c)}},i=t=>t.done?v(t.value):Promise.resolve(t.value).then(g,x);i((u=u.apply(d,f)).next())});import{u as j,F as z}from"./useForm-agan0gLz.js";import{u as G}from"./useValidator-b4d-vg8t.js";import{I as L}from"./index-E_cr-WWq.js";import{J as M,b,af as N}from"./element-plus-LfFKO5To.js";import{l as U,J as q,O as a,V as r,P as E,a as m,b as J,m as V,p as S,u as w,W as A,X as O}from"./vue-chunks-NBL-ZipP.js";const Y=U({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(d,{expose:f}){const{required:u}=G(),v=d,p=q([{field:"upload_method",label:"上传方式",colProps:{span:24},component:"RadioGroup",componentProps:{options:[{label:"同时上传",value:"1"},{label:"按顺序上传",value:"2"}]},value:"1",formItemProps:{rules:[u()]}},{field:"images",label:"",colProps:{span:24},formItemProps:{rules:[u()],slots:{default:()=>a(E,null,[a("div",{class:"flex justify-between w-[100%]"},[a("span",null,[r("图片资源")]),a("span",null,[r("最大数量限制："),s.value.length,r("/"),n.value])]),a(M,{class:"resource-image-uploader",action:"#","http-request":_,"file-list":s.value,"onUpdate:file-list":e=>s.value=e,"show-file-list":!0,multiple:!0,"before-upload":C,"on-success":D,"on-preview":y,"on-exceed":R,accept:"image/jpeg,image/png",name:"file","list-type":"picture-card",limit:n.value,drag:!0,disabled:n.value<=s.value.length},{default:()=>[s.value.length<n.value?a("div",{class:"resource-image-uploader-icon"},[a(L,{icon:"akar-icons:plus",size:23},null),a("span",{class:"text-[12px]"},[r("点击或拖拽到这里")]),a("span",{class:"text-[12px]"},[s.value.length,r("/"),n.value])]):a("div",{class:"resource-image-uploader-icon"},[a("span",{class:"text-[12px]"},[r("已到最大限制")]),a("span",{class:"text-[12px]"},[s.value.length,r("/"),n.value])])]})])}}}]),{formRegister:g,formMethods:x}=j(),{setValues:i,getFormData:t,getElFormExpose:c,setValue:I}=x,h=m(!1),F=m(0),n=m(50),s=m([]),C=e=>{const l=["image/jpeg","image/gif","image/png"].includes(e.type),o=e.size/1024/1024<3;return l||b.error("上传图片素材必须是 JPG/PNG/ 格式!"),o||b.error("上传图片素材大小不能超过 3MB!"),l&&o},D=(e,l,o)=>{s.value=o,I("images",o)},_=e=>new Promise(l=>{l(e)}),y=e=>{F.value=s.value.findIndex(l=>l.uid===e.uid),h.value=!0},B=()=>{h.value=!1},R=()=>{b.error("上传失败，超出图片最大数量限制!")},k=()=>P(this,null,function*(){const e=yield c();if(yield e==null?void 0:e.validate())return yield t()});return J(()=>v.currentRow,e=>{e&&i(e)},{deep:!0,immediate:!0}),f({submit:k}),(e,l)=>(V(),S(E,null,[a(w(z),{onRegister:w(g),schema:p},null,8,["onRegister","schema"]),h.value?(V(),A(w(N),{key:0,"z-index":9999,onClose:B,"url-list":s.value.map(o=>o.url),"initial-index":F.value},null,8,["url-list","initial-index"])):O("",!0)],64))}});export{Y as _};
//# sourceMappingURL=Write.vue_vue_type_style_index_0_lang-FZ-9RKR-.js.map
