{"version":3,"file":"Reset-4hdywhZD.js","sources":["../../src/views/Reset/Reset.vue"],"sourcesContent":["<script setup lang=\"tsx\">\nimport { Form, FormSchema } from '@/components/Form'\nimport { useForm } from '@/hooks/web/useForm'\nimport { computed, reactive, ref, watch } from 'vue'\nimport { useValidator } from '@/hooks/web/useValidator'\nimport { useAuthStore } from '@/store/modules/auth'\nimport { ElMessage } from 'element-plus'\nimport { postCurrentUserResetPassword } from '@/api/vadmin/auth/user'\nimport { getRoleMenusApi } from '@/api/login'\nimport { usePermissionStore } from '@/store/modules/permission'\nimport { RouteLocationNormalizedLoaded, RouteRecordRaw, useRouter } from 'vue-router'\nimport { useAppStore } from '@/store/modules/app'\nimport { Footer } from '@/components/Footer'\n\nconst { required } = useValidator()\nconst { addRoute, push, currentRoute } = useRouter()\n\nconst authStore = useAuthStore()\nconst appStore = useAppStore()\nconst permissionStore = usePermissionStore()\n\nconst footer = computed(() => appStore.getFooter)\n\nconst formSchema = reactive<FormSchema[]>([\n  {\n    field: 'password',\n    label: '新密码',\n    component: 'InputPassword',\n    colProps: {\n      span: 24\n    },\n    componentProps: {\n      style: {\n        width: '100%'\n      },\n      placeholder: '请输入新密码'\n    }\n  },\n  {\n    field: 'password_two',\n    label: '再次输入新密码',\n    component: 'InputPassword',\n    colProps: {\n      span: 24\n    },\n    componentProps: {\n      style: {\n        width: '100%'\n      },\n      placeholder: '请再次输入新密码'\n    }\n  }\n])\n\nconst rules = {\n  password: [\n    required(),\n    { min: 8, max: 16, message: '长度需为8-16个字符,请重新输入。', trigger: 'blur' }\n  ],\n  password_two: [\n    required(),\n    { min: 8, max: 16, message: '长度需为8-16个字符,请重新输入。', trigger: 'blur' }\n  ]\n}\n\nconst { formRegister, formMethods } = useForm()\nconst { setValues, getFormData, getElFormExpose } = formMethods\n\nsetValues(authStore.getUser)\n\nconst loading = ref(false)\nconst redirect = ref<string>('')\n\nwatch(\n  () => currentRoute.value,\n  (route: RouteLocationNormalizedLoaded) => {\n    redirect.value = route?.query?.redirect as string\n  },\n  {\n    immediate: true\n  }\n)\n\n// 提交\nconst save = async () => {\n  if (authStore.getUser.id === 1) {\n    return ElMessage.warning('编辑账号为演示账号，无权限操作！')\n  }\n  const elForm = await getElFormExpose()\n  const valid = await elForm?.validate()\n  if (valid) {\n    loading.value = true\n    const formData = await getFormData()\n    try {\n      const res = await postCurrentUserResetPassword(formData)\n      if (res) {\n        // 是否使用动态路由\n        getMenu()\n      } else {\n        loading.value = false\n      }\n    } catch (e: any) {\n      loading.value = false\n    }\n  }\n}\n\n// 获取用户菜单信息\nconst getMenu = async () => {\n  const res = await getRoleMenusApi()\n  if (res) {\n    const routers = res.data || []\n    await permissionStore.generateRoutes(routers).catch(() => {})\n    permissionStore.getAddRouters.forEach((route) => {\n      addRoute(route as RouteRecordRaw) // 动态添加可访问路由表\n    })\n    permissionStore.setIsAddRouters(true)\n    push({ path: redirect.value || permissionStore.addRouters[0].path })\n  }\n}\n</script>\n\n<template>\n  <div class=\"main-container\">\n    <div class=\"form-container\">\n      <div>\n        <h2 class=\"text-2xl font-bold text-center w-[100%]\">第一次登录系统，需先重置密码</h2>\n      </div>\n      <Form\n        @register=\"formRegister\"\n        :schema=\"formSchema\"\n        :rules=\"rules\"\n        hide-required-asterisk\n        class=\"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid\"\n      />\n      <div class=\"w-[100%]\">\n        <BaseButton :loading=\"loading\" type=\"primary\" class=\"w-[100%]\" @click=\"save\">\n          重置密码\n        </BaseButton>\n      </div>\n    </div>\n\n    <div class=\"footer-container\">\n      <Footer v-if=\"footer\" />\n    </div>\n  </div>\n</template>\n\n<style lang=\"less\" scoped>\n:deep(.anticon) {\n  &:hover {\n    color: var(--el-color-primary) !important;\n  }\n}\n\n.main-container {\n  display: flex;\n  flex-direction: column;\n  padding-top: 20px;\n  width: 100%;\n  height: 100%;\n  background-color: var(--app-content-bg-color);\n  position: relative;\n}\n\n.main-container .form-container {\n  width: 500px;\n  align-self: center;\n  padding: 30px;\n  background-color: #fff;\n  border-radius: 30px;\n}\n\n.footer-container {\n  position: absolute;\n  bottom: 0;\n  margin-bottom: 20px;\n  width: 100%;\n}\n</style>\n"],"names":["required","useValidator","addRoute","push","currentRoute","useRouter","authStore","useAuthStore","appStore","useAppStore","permissionStore","usePermissionStore","footer","computed","getFooter","formSchema","reactive","field","label","component","colProps","span","componentProps","style","width","placeholder","rules","password","min","max","message","trigger","password_two","formRegister","formMethods","useForm","setValues","getFormData","getElFormExpose","getUser","loading","ref","redirect","watch","value","route","query","immediate","save","__async","id","ElMessage","warning","elForm","validate","formData","postCurrentUserResetPassword","getMenu","e","res","getRoleMenusApi","routers","data","generateRoutes","catch","getAddRouters","forEach","setIsAddRouters","path","addRouters"],"mappings":"qiCAcA,KAAM,CAAEA,SAAAA,CAAU,EAAGC,EAAY,EAC3B,CAAEC,SAAAA,EAAUC,KAAAA,EAAMC,aAAAA,CAAc,EAAGC,EAAS,EAE5CC,EAAYC,IACZC,EAAWC,IACXC,EAAkBC,IAElBC,EAASC,EAAS,IAAML,EAASM,SAAS,EAE1CC,EAAaC,EAAuB,CACxC,CACEC,MAAO,WACPC,MAAO,MACPC,UAAW,gBACXC,SAAU,CACRC,KAAM,EACP,EACDC,eAAgB,CACdC,MAAO,CACLC,MAAO,MACR,EACDC,YAAa,QACf,CACF,EACA,CACER,MAAO,eACPC,MAAO,UACPC,UAAW,gBACXC,SAAU,CACRC,KAAM,EACP,EACDC,eAAgB,CACdC,MAAO,CACLC,MAAO,MACR,EACDC,YAAa,UACf,CACD,CAAA,CACF,EAEKC,EAAQ,CACZC,SAAU,CACR3B,IACA,CAAE4B,IAAK,EAAGC,IAAK,GAAIC,QAAS,qBAAsBC,QAAS,MAAO,CAAC,EAErEC,aAAc,CACZhC,IACA,CAAE4B,IAAK,EAAGC,IAAK,GAAIC,QAAS,qBAAsBC,QAAS,OAAQ,GAIjE,CAAEE,aAAAA,EAAcC,YAAAA,CAAa,EAAGC,EAAO,EACvC,CAAEC,UAAAA,EAAWC,YAAAA,EAAaC,gBAAAA,CAAiB,EAAGJ,EAEpDE,EAAU9B,EAAUiC,OAAO,EAE3B,MAAMC,EAAUC,EAAI,EAAK,EACnBC,EAAWD,EAAY,EAAE,EAE/BE,EACE,IAAMvC,EAAawC,MAClBC,GAAyC,OACxCH,EAASE,OAAQC,EAAAA,GAAAA,YAAAA,EAAOC,QAAPD,YAAAA,EAAcH,QACjC,EACA,CACEK,UAAW,EACb,CACF,EAGA,MAAMC,EAAO,IAAYC,EAAA,sBACvB,GAAI3C,EAAUiC,QAAQW,KAAO,EAC3B,OAAOC,EAAUC,QAAQ,kBAAkB,EAE7C,MAAMC,EAAS,MAAMf,IAErB,GADc,MAAMe,GAAAA,YAAAA,EAAQC,WACjB,CACTd,EAAQI,MAAQ,GAChB,MAAMW,EAAW,MAAMlB,IACvB,GAAI,EACU,MAAMmB,EAA6BD,CAAQ,GAGrDE,IAEAjB,EAAQI,MAAQ,EAEnB,OAAQc,EAAQ,CACflB,EAAQI,MAAQ,EAClB,CACF,IAIIa,EAAU,IAAYR,EAAA,sBAC1B,MAAMU,EAAM,MAAMC,IAClB,GAAID,EAAK,CACP,MAAME,EAAUF,EAAIG,MAAQ,GAC5B,MAAMpD,EAAgBqD,eAAeF,CAAO,EAAEG,MAAM,IAAM,CAAA,CAAE,EAC5DtD,EAAgBuD,cAAcC,QAASrB,GAAU,CAC/C3C,EAAS2C,CAAuB,CAClC,CAAC,EACDnC,EAAgByD,gBAAgB,EAAI,EACpChE,EAAK,CAAEiE,KAAM1B,EAASE,OAASlC,EAAgB2D,WAAW,CAAC,EAAED,IAAK,CAAC,CACrE"}