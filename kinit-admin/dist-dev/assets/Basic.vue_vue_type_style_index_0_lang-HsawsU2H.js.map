{"version":3,"file":"Basic.vue_vue_type_style_index_0_lang-HsawsU2H.js","sources":["../../src/views/Vadmin/System/Settings/components/Basic.vue"],"sourcesContent":["<script setup lang=\"tsx\">\nimport { Form, FormSchema } from '@/components/Form'\nimport { useForm } from '@/hooks/web/useForm'\nimport { ElUpload } from 'element-plus'\nimport { getSystemSettingsApi, putSystemSettingsApi } from '@/api/vadmin/system/settings'\nimport { reactive, ref, computed } from 'vue'\nimport { ElMessage, ElIcon } from 'element-plus'\nimport type { UploadProps } from 'element-plus'\nimport { useAuthStore } from '@/store/modules/auth'\nimport { useAppStore } from '@/store/modules/app'\nimport { propTypes } from '@/utils/propTypes'\nimport { Icon } from '@/components/Icon'\nimport { useValidator } from '@/hooks/web/useValidator'\nimport { BaseButton } from '@/components/Button'\n\nconst { required } = useValidator()\nconst authStore = useAuthStore()\nconst appStore = useAppStore()\n\nconst props = defineProps({\n  tabId: propTypes.number\n})\n\nconst token = computed(() => authStore.getToken)\n\nconst formSchema = reactive<FormSchema[]>([\n  {\n    field: 'web_title',\n    label: '系统标题',\n    colProps: {\n      span: 24\n    },\n    component: 'Input',\n    componentProps: {\n      style: {\n        width: '500px'\n      }\n    }\n  },\n  {\n    field: 'web_logo',\n    label: '系统 LOGO',\n    colProps: {\n      span: 24\n    },\n    formItemProps: {\n      slots: {\n        default: (data) => {\n          const beforeImageUpload: UploadProps['beforeUpload'] = (rawFile) => {\n            const isIMAGE = ['image/jpeg', 'image/gif', 'image/png'].includes(rawFile.type)\n            const isLtSize = rawFile.size / 1024 / 1024 < 5\n\n            if (!isIMAGE) {\n              ElMessage.error('上传LOGO图片必须是 JPG/GIF/PNG/ 格式!')\n            }\n            if (!isLtSize) {\n              ElMessage.error('上传LOGO图片大小不能超过 5MB!')\n            }\n            return isIMAGE && isLtSize\n          }\n\n          // 上传成功的钩子函数\n          const handleUploadSuccess: UploadProps['onSuccess'] = (response) => {\n            if (response.code === 200) {\n              // setValue('web_logo', response.data.remote_path)\n              data.web_logo = response.data.remote_path\n            } else {\n              ElMessage.error(response.message)\n            }\n          }\n          return (\n            <ElUpload\n              class=\"system-settings-basic-image-uploader\"\n              action=\"/api/vadmin/system/upload/image/to/local\"\n              data={{ path: 'system' }}\n              show-file-list={false}\n              before-upload={beforeImageUpload}\n              on-success={handleUploadSuccess}\n              accept=\"image/jpeg,image/gif,image/png\"\n              name=\"file\"\n              headers={{ Authorization: token }}\n            >\n              {data.web_logo ? (\n                <img src={data.web_logo} class=\"logo-image\" />\n              ) : (\n                <ElIcon class=\"logo-image-uploader-icon\">\n                  <Icon icon=\"akar-icons:plus\" size={23} />\n                </ElIcon>\n              )}\n            </ElUpload>\n          )\n        }\n      }\n    }\n  },\n  {\n    field: 'web_desc',\n    label: '系统描述',\n    colProps: {\n      span: 24\n    },\n    component: 'Input',\n    componentProps: {\n      rows: 4,\n      type: 'textarea',\n      style: {\n        width: '500px'\n      }\n    }\n  },\n  {\n    field: 'web_ico',\n    label: 'ICO 图标',\n    colProps: {\n      span: 24\n    },\n    formItemProps: {\n      slots: {\n        default: (data) => {\n          const beforeImageUpload: UploadProps['beforeUpload'] = (rawFile) => {\n            const isIMAGE = ['image/x-icon'].includes(rawFile.type)\n            const isLtSize = rawFile.size / 1024 / 1024 < 2\n\n            if (!isIMAGE) {\n              ElMessage.error('上传ICO图标必须是 ico 格式!')\n            }\n            if (!isLtSize) {\n              ElMessage.error('上传ICO图标大小不能超过 2MB!')\n            }\n            return isIMAGE && isLtSize\n          }\n\n          // 上传成功的钩子函数\n          const handleUploadSuccess: UploadProps['onSuccess'] = (response) => {\n            if (response.code === 200) {\n              // setValue('web_ico', response.data.remote_path)\n              // setValue('web_ico_local_path', response.data.local_path)\n              data.web_ico = response.data.remote_path\n              data.web_ico_local_path = response.data.local_path\n            } else {\n              ElMessage.error(response.message)\n            }\n          }\n          return (\n            <ElUpload\n              class=\"system-settings-basic-image-uploader\"\n              action=\"/api/vadmin/system/upload/image/to/local\"\n              data={{ path: 'system' }}\n              show-file-list={false}\n              before-upload={beforeImageUpload}\n              on-success={handleUploadSuccess}\n              accept=\"image/x-icon\"\n              name=\"file\"\n              headers={{ Authorization: token }}\n            >\n              {data.web_ico ? (\n                <img src={data.web_ico} class=\"ico-image\" />\n              ) : (\n                <ElIcon class=\"ico-image-uploader-icon\">\n                  <Icon icon=\"akar-icons:plus\" size={23} />\n                </ElIcon>\n              )}\n            </ElUpload>\n          )\n        }\n      }\n    }\n  },\n  {\n    field: 'web_ico_local_path',\n    label: 'ICO 图标服务器文件地址',\n    component: 'Input',\n    colProps: {\n      span: 24\n    },\n    hidden: true\n  },\n  {\n    field: 'web_icp_number',\n    label: '备案号',\n    colProps: {\n      span: 24\n    },\n    component: 'Input',\n    componentProps: {\n      style: {\n        width: '500px'\n      }\n    }\n  },\n  {\n    field: 'web_copyright',\n    label: '版权信息',\n    colProps: {\n      span: 24\n    },\n    component: 'Input',\n    componentProps: {\n      style: {\n        width: '500px'\n      }\n    }\n  },\n  {\n    field: 'active',\n    label: '',\n    colProps: {\n      span: 24\n    },\n    formItemProps: {\n      slots: {\n        default: () => {\n          return (\n            <>\n              <BaseButton loading={loading.value} type=\"primary\" onClick={save}>\n                立即提交\n              </BaseButton>\n            </>\n          )\n        }\n      }\n    }\n  }\n])\n\nconst rules = reactive({\n  web_title: [required()],\n  web_logo: [required()],\n  web_ico: [required()]\n})\n\nconst { formRegister, formMethods } = useForm()\nconst { setValues, getFormData, getElFormExpose } = formMethods\n\nlet formData = ref({} as Recordable)\n\nconst getData = async () => {\n  const res = await getSystemSettingsApi({ tab_id: props.tabId })\n  if (res) {\n    await setValues(res.data)\n    formData.value = res.data\n    const elForm = await getElFormExpose()\n    elForm?.clearValidate()\n  }\n}\n\nconst loading = ref(false)\n\nconst save = async () => {\n  const elForm = await getElFormExpose()\n  const valid = await elForm?.validate()\n  if (valid) {\n    const formData = await getFormData()\n    loading.value = true\n    if (!formData) {\n      loading.value = false\n      return ElMessage.error('未获取到数据')\n    }\n    try {\n      const res = await putSystemSettingsApi(formData)\n      if (res) {\n        appStore.setTitle(formData.web_title || import.meta.env.VITE_APP_TITLE)\n        appStore.setLogoImage(formData.web_logo || '/media/system/logo.png')\n        appStore.setFooterContent(formData.web_copyright || 'Copyright ©2022-present K')\n        appStore.setIcpNumber(formData.web_icp_number || '')\n        return ElMessage.success('更新成功')\n      }\n    } finally {\n      loading.value = false\n    }\n  }\n}\n\ngetData()\n</script>\n\n<template>\n  <Form :rules=\"rules\" @register=\"formRegister\" :schema=\"formSchema\" />\n</template>\n\n<style lang=\"less\">\n.system-settings-basic-image-uploader {\n  .logo-image {\n    width: 178px;\n    height: 178px;\n    display: block;\n  }\n\n  .ico-image {\n    width: 100px;\n    height: 100px;\n    display: block;\n  }\n\n  .el-upload {\n    border: 1px dashed var(--el-border-color);\n    border-radius: 6px;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n    transition: var(--el-transition-duration-fast);\n  }\n\n  .el-upload:hover {\n    border-color: var(--el-color-primary);\n  }\n\n  .el-icon.logo-image-uploader-icon {\n    font-size: 28px;\n    color: #8c939d;\n    width: 178px;\n    height: 178px;\n    text-align: center;\n  }\n\n  .el-icon.ico-image-uploader-icon {\n    font-size: 28px;\n    color: #8c939d;\n    width: 100px;\n    height: 100px;\n    text-align: center;\n  }\n}\n</style>\n"],"names":["required","useValidator","authStore","useAuthStore","appStore","useAppStore","props","__props","token","computed","getToken","formSchema","reactive","field","label","colProps","span","component","componentProps","style","width","formItemProps","slots","default","data","_createVNode","ElUpload","path","rawFile","isIMAGE","includes","type","isLtSize","size","ElMessage","error","response","code","web_logo","remote_path","message","Authorization","ElIcon","Icon","rows","web_ico","web_ico_local_path","local_path","hidden","_Fragment","BaseButton","loading","value","save","_createTextVNode","rules","web_title","formRegister","formMethods","useForm","setValues","getFormData","getElFormExpose","formData","ref","getData","__async","res","getSystemSettingsApi","tab_id","tabId","elForm","clearValidate","validate","putSystemSettingsApi","setTitle","import","setLogoImage","setFooterContent","web_copyright","setIcpNumber","web_icp_number","success"],"mappings":"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"}