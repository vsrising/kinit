{"version":3,"file":"Image-Z0L9GKab.js","sources":["../../src/api/vadmin/resource/images.ts","../../src/views/Vadmin/Resource/Image/Image.vue"],"sourcesContent":["import request from '@/config/axios'\n\n/**\n * 图片资源管理管理\n */\n\nexport const getImagesListApi = (params: any): Promise<IResponse> => {\n  return request.get({ url: '/vadmin/resource/images', params })\n}\n\nexport const addImagesApi = (data: any): Promise<IResponse> => {\n  return request.post({\n    url: '/vadmin/resource/images',\n    headersType: 'multipart/form-data',\n    data\n  })\n}\n\nexport const delImagesListApi = (data: number[]): Promise<IResponse> => {\n  return request.delete({ url: `/vadmin/resource/images`, data })\n}\n\nexport const getImagesApi = (dataId: number): Promise<IResponse> => {\n  return request.get({ url: `/vadmin/resource/images/${dataId}` })\n}\n","<script setup lang=\"tsx\">\nimport { reactive, ref, unref } from 'vue'\nimport { addImagesApi, getImagesListApi, delImagesListApi } from '@/api/vadmin/resource/images'\nimport { useTable } from '@/hooks/web/useTable'\nimport { useI18n } from '@/hooks/web/useI18n'\nimport { Table, TableColumn } from '@/components/Table'\nimport { ElMessage, ElRow, ElCol, ElImage } from 'element-plus'\nimport { Search } from '@/components/Search'\nimport { FormSchema } from '@/components/Form'\nimport { ContentWrap } from '@/components/ContentWrap'\nimport Write from './components/Write.vue'\nimport { Dialog } from '@/components/Dialog'\nimport { useClipboard } from '@vueuse/core'\nimport { BaseButton } from '@/components/Button'\n\ndefineOptions({\n  name: 'ResourceImage'\n})\n\nconst { t } = useI18n()\n\nconst { tableRegister, tableState, tableMethods } = useTable({\n  fetchDataApi: async () => {\n    const { pageSize, currentPage } = tableState\n    const res = await getImagesListApi({\n      page: unref(currentPage),\n      limit: unref(pageSize),\n      ...unref(searchParams)\n    })\n    return {\n      list: res.data || [],\n      total: res.count || 0\n    }\n  },\n  fetchDelApi: async (value) => {\n    const res = await delImagesListApi(value as number[])\n    return res.code === 200\n  }\n})\n\nconst { dataList, loading, total, pageSize, currentPage } = tableState\nconst { getList, delList } = tableMethods\n\nconst tableColumns = reactive<TableColumn[]>([\n  {\n    field: 'selection',\n    type: 'selection',\n    show: true,\n    disabled: true\n  },\n  {\n    field: 'id',\n    label: '编号',\n    show: true,\n    disabled: false,\n    align: 'center',\n    headerAlign: 'center',\n    width: '80px'\n  },\n  {\n    field: 'image_url',\n    label: '图片',\n    show: true,\n    disabled: true,\n    minWidth: '90px',\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return (\n          <>\n            <div class=\"resource-image-name flex items-center\">\n              <div>\n                <ElImage\n                  src={`${row.image_url}?x-oss-process=image/resize,m_fixed,h_100`}\n                  zoom-rate={1.2}\n                  preview-src-list={dataList.value.map((item) => item.image_url)}\n                  preview-teleported={true}\n                  initial-index={data.$index}\n                  style=\"height: 60px; display: block\"\n                  fit=\"cover\"\n                />\n              </div>\n              <div class=\"leading-[35px] ml-2 truncate\">\n                <span>{row.filename}</span>\n              </div>\n            </div>\n          </>\n        )\n      }\n    }\n  },\n  {\n    field: 'remark',\n    label: '备注',\n    show: false,\n    disabled: false\n  },\n  {\n    field: 'update_datetime',\n    label: '更新时间',\n    show: false,\n    width: '180px'\n  },\n  {\n    field: 'create_datetime',\n    label: '创建时间',\n    width: '180px',\n    show: true\n  },\n  {\n    field: 'create_user.name',\n    label: '创建人',\n    show: false\n  },\n  {\n    field: 'action',\n    width: '200px',\n    label: '操作',\n    fixed: 'right',\n    disabled: false,\n    show: true,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return (\n          <>\n            <BaseButton type=\"primary\" link size=\"small\" onClick={() => toCopy(row.id)}>\n              复制编号\n            </BaseButton>\n            <BaseButton type=\"primary\" link size=\"small\" onClick={() => toCopy(row.image_url)}>\n              复制链接\n            </BaseButton>\n            <BaseButton\n              type=\"danger\"\n              loading={delLoading.value}\n              link\n              size=\"small\"\n              onClick={() => delData(row)}\n            >\n              删除\n            </BaseButton>\n          </>\n        )\n      }\n    }\n  }\n])\n\nconst searchSchema = reactive<FormSchema[]>([\n  {\n    field: 'filename',\n    label: '文件名称',\n    component: 'Input',\n    componentProps: {\n      clearable: false,\n      style: {\n        width: '214px'\n      }\n    }\n  }\n])\n\nconst searchParams = ref({})\nconst setSearchParams = (data: any) => {\n  currentPage.value = 1\n  searchParams.value = data\n  getList()\n}\n\nconst delLoading = ref(false)\n\nconst delData = async (row?: any) => {\n  delLoading.value = true\n  if (row) {\n    await delList(true, [row.id]).finally(() => {\n      delLoading.value = false\n    })\n  } else {\n    await delList(true).finally(() => {\n      delLoading.value = false\n    })\n  }\n}\n\nconst dialogVisible = ref(false)\nconst dialogTitle = ref('')\n\nconst currentRow = ref()\nconst actionType = ref('')\n\nconst writeRef = ref<ComponentRef<typeof Write>>()\n\nconst saveLoading = ref(false)\n\n// 复制数据到剪切板\nconst toCopy = async (value: string) => {\n  // 复制功能打包部署到线上后，需要线上地址使用 https 才可使用\n  const { copy } = useClipboard()\n  await copy(value)\n  return ElMessage.success('复制成功')\n}\n\nconst addAction = () => {\n  dialogTitle.value = '新增图片素材'\n  actionType.value = 'add'\n  currentRow.value = undefined\n  dialogVisible.value = true\n}\n\nconst save = async () => {\n  const write = unref(writeRef)\n  const formData = await write?.submit()\n  if (formData) {\n    saveLoading.value = true\n    formData?.images.forEach((item) => (item.status = 'uploading'))\n    if (formData?.upload_method === '2') {\n      // 按顺序上传文件\n      for (const item of formData?.images) {\n        const data = new FormData()\n        data.append('file', item.raw)\n        await addImagesApi(data)\n        item.status = 'success'\n      }\n    } else if (formData?.upload_method === '1') {\n      // 同时上传文件\n      const uploadPromises = formData?.images.map(async (item) => {\n        const data = new FormData()\n        data.append('file', item.raw)\n        await addImagesApi(data)\n        item.status = 'success'\n      })\n      await Promise.all(uploadPromises)\n    }\n    // 全部上传完成后执行的代码\n    getList()\n    dialogVisible.value = false\n    saveLoading.value = false\n  }\n}\n</script>\n\n<template>\n  <ContentWrap>\n    <Search :schema=\"searchSchema\" @reset=\"setSearchParams\" @search=\"setSearchParams\" />\n    <Table\n      v-model:current-page=\"currentPage\"\n      v-model:page-size=\"pageSize\"\n      showAction\n      :columns=\"tableColumns\"\n      default-expand-all\n      node-key=\"id\"\n      :data=\"dataList\"\n      :loading=\"loading\"\n      :pagination=\"{\n        total\n      }\"\n      @register=\"tableRegister\"\n      @refresh=\"getList\"\n    >\n      <template #toolbar>\n        <ElRow :gutter=\"10\">\n          <ElCol :span=\"1.5\">\n            <BaseButton type=\"primary\" @click=\"addAction\">新增图片素材</BaseButton>\n            <BaseButton type=\"danger\" @click=\"delData(null)\">批量删除</BaseButton>\n          </ElCol>\n        </ElRow>\n      </template>\n    </Table>\n  </ContentWrap>\n\n  <Dialog v-model=\"dialogVisible\" :title=\"dialogTitle\" width=\"996px\" height=\"600px\" top=\"3vh\">\n    <Write ref=\"writeRef\" :current-row=\"currentRow\" />\n\n    <template #footer>\n      <BaseButton type=\"primary\" :loading=\"saveLoading\" @click=\"save\">\n        {{ t('exampleDemo.save') }}\n      </BaseButton>\n      <BaseButton @click=\"dialogVisible = false\">{{ t('dialogDemo.close') }}</BaseButton>\n    </template>\n  </Dialog>\n</template>\n"],"names":["getImagesListApi","params","request","addImagesApi","data","delImagesListApi","t","useI18n","tableRegister","tableState","tableMethods","useTable","fetchDataApi","__async","pageSize","currentPage","res","__spreadValues","page","unref","limit","searchParams","list","total","count","fetchDelApi","value","code","dataList","loading","getList","delList","tableColumns","reactive","field","type","show","disabled","label","align","headerAlign","width","minWidth","slots","default","row","_createVNode2","_Fragment2","ElImage","image_url","map","item","$index","filename","fixed","BaseButton","onClick","toCopy","id","_createTextVNode2","delLoading","delData","searchSchema","component","componentProps","clearable","style","ref","setSearchParams","finally","dialogVisible","dialogTitle","currentRow","actionType","writeRef","saveLoading","copy","useClipboard","ElMessage","success","addAction","undefined","save","write","formData","submit","images","forEach","status","upload_method","FormData","append","raw","uploadPromises","Promise","all"],"mappings":"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"}