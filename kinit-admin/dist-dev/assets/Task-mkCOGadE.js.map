{"version":3,"file":"Task-mkCOGadE.js","sources":["../../src/views/Vadmin/System/Record/Task/Task.vue"],"sourcesContent":["<script setup lang=\"tsx\">\nimport { reactive, ref, unref } from 'vue'\nimport { useTable } from '@/hooks/web/useTable'\nimport { useI18n } from '@/hooks/web/useI18n'\nimport { Table, TableColumn } from '@/components/Table'\nimport { Search } from '@/components/Search'\nimport { FormSchema } from '@/components/Form'\nimport { ContentWrap } from '@/components/ContentWrap'\nimport Detail from './components/Detail.vue'\nimport { Dialog } from '@/components/Dialog'\nimport { selectDictLabel, DictDetail } from '@/utils/dict'\nimport { useDictStore } from '@/store/modules/dict'\nimport { useRouter } from 'vue-router'\nimport { getTaskRecordListApi } from '@/api/vadmin/system/task'\nimport { BaseButton } from '@/components/Button'\n\ndefineOptions({\n  name: 'SystemRecordTask'\n})\n\nconst { t } = useI18n()\nconst { currentRoute } = useRouter()\n\nconst job_id = currentRoute.value.query.job_id\n\nconst execStrategyOptions = ref<DictDetail[]>([])\n\nconst getOptions = async () => {\n  const dictStore = useDictStore()\n  const dictOptions = await dictStore.getDictObj(['vadmin_system_task_exec_strategy'])\n  execStrategyOptions.value = dictOptions.vadmin_system_task_exec_strategy\n}\n\ngetOptions()\n\nconst { tableRegister, tableState, tableMethods } = useTable({\n  immediate: false,\n  fetchDataApi: async () => {\n    const { pageSize, currentPage } = tableState\n    const res = await getTaskRecordListApi({\n      page: unref(currentPage),\n      limit: unref(pageSize),\n      ...unref(searchParams)\n    })\n    return {\n      list: res.data || [],\n      total: res.count || 0\n    }\n  }\n})\n\nconst { dataList, loading, total, pageSize, currentPage } = tableState\nconst { getList } = tableMethods\n\nconst tableColumns = reactive<TableColumn[]>([\n  {\n    field: 'job_id',\n    label: '任务编号',\n    show: true,\n    disabled: true,\n    width: '240px'\n  },\n  {\n    field: 'name',\n    label: '任务名称',\n    show: true,\n    disabled: true\n  },\n  {\n    field: 'group',\n    label: '任务分组',\n    show: true,\n    span: 2\n  },\n  {\n    field: 'job_class',\n    label: '调用目标',\n    show: true\n  },\n  {\n    field: 'exec_strategy',\n    label: '执行策略',\n    show: true,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return (\n          <>\n            <div>{selectDictLabel(execStrategyOptions.value, row.exec_strategy)}</div>\n          </>\n        )\n      }\n    }\n  },\n  {\n    field: 'expression',\n    label: '表达式',\n    show: true,\n    span: 24\n  },\n  {\n    field: 'start_time',\n    label: '开始执行时间',\n    show: false,\n    width: '200px'\n  },\n  {\n    field: 'end_time',\n    label: '执行完成时间',\n    width: '200px',\n    show: true\n  },\n  {\n    field: 'process_time',\n    label: '耗时(秒)',\n    width: '110px',\n    show: true\n  },\n  {\n    field: 'retval',\n    label: '任务返回值',\n    show: true,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return JSON.parse(row.retval)\n      }\n    }\n  },\n  {\n    field: 'exception',\n    label: '异常信息',\n    show: false,\n    span: 24\n  },\n  {\n    field: 'traceback',\n    label: '堆栈跟踪',\n    show: false,\n    width: '100px'\n  },\n  {\n    field: 'action',\n    width: '100px',\n    label: '操作',\n    show: true,\n    disabled: true,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return (\n          <>\n            <BaseButton type=\"primary\" link size=\"small\" onClick={() => view(row)}>\n              详情\n            </BaseButton>\n          </>\n        )\n      }\n    }\n  }\n])\n\nconst searchSchema = reactive<FormSchema[]>([\n  {\n    field: 'job_id',\n    label: '任务编号',\n    component: 'Input',\n    componentProps: {\n      clearable: true,\n      style: {\n        width: '240px'\n      }\n    },\n    value: job_id\n  },\n  {\n    field: 'name',\n    label: '任务名称',\n    component: 'Input',\n    componentProps: {\n      clearable: true\n    }\n  }\n])\n\nconst searchParams = ref({})\nconst setSearchParams = (data: any) => {\n  currentPage.value = 1\n  searchParams.value = data\n  getList()\n}\n\nconst dialogVisible = ref(false)\nconst dialogTitle = ref('')\n\nconst currentRow = ref()\nconst actionType = ref('')\n\nconst view = (row) => {\n  dialogTitle.value = t('exampleDemo.detail')\n  actionType.value = 'detail'\n  currentRow.value = row\n  dialogVisible.value = true\n}\n\nif (job_id) {\n  searchParams.value = { job_id: job_id }\n  getList()\n} else {\n  getList()\n}\n</script>\n\n<template>\n  <ContentWrap>\n    <Search :schema=\"searchSchema\" @reset=\"setSearchParams\" @search=\"setSearchParams\" />\n    <Table\n      v-model:current-page=\"currentPage\"\n      v-model:page-size=\"pageSize\"\n      showAction\n      :columns=\"tableColumns\"\n      node-key=\"id\"\n      :data=\"dataList\"\n      :loading=\"loading\"\n      :pagination=\"{\n        total\n      }\"\n      @register=\"tableRegister\"\n      @refresh=\"getList\"\n    />\n  </ContentWrap>\n\n  <Dialog v-model=\"dialogVisible\" :title=\"dialogTitle\" width=\"800px\">\n    <Detail v-if=\"actionType === 'detail'\" :current-row=\"currentRow\" />\n\n    <template #footer>\n      <BaseButton @click=\"dialogVisible = false\">{{ t('dialogDemo.close') }}</BaseButton>\n    </template>\n  </Dialog>\n</template>\n"],"names":["t","useI18n","currentRoute","useRouter","job_id","value","query","execStrategyOptions","ref","__async","dictOptions","useDictStore","getDictObj","vadmin_system_task_exec_strategy","tableRegister","tableState","tableMethods","useTable","immediate","fetchDataApi","pageSize","currentPage","res","getTaskRecordListApi","__spreadValues","page","unref","limit","searchParams","list","data","total","count","dataList","loading","getList","tableColumns","reactive","field","label","show","disabled","width","span","slots","default","row","_createVNode2","_Fragment2","selectDictLabel","exec_strategy","JSON","parse","retval","BaseButton","onClick","view","_createTextVNode2","searchSchema","component","componentProps","clearable","style","setSearchParams","dialogVisible","dialogTitle","currentRow","actionType"],"mappings":"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"}