{"version":3,"file":"Role-wGPxItO8.js","sources":["../../src/views/Vadmin/Auth/Role/Role.vue"],"sourcesContent":["<script setup lang=\"tsx\">\nimport { reactive, ref, unref } from 'vue'\nimport {\n  getRoleListApi,\n  addRoleListApi,\n  delRoleListApi,\n  putRoleListApi,\n  getRoleApi\n} from '@/api/vadmin/auth/role'\nimport { useTable } from '@/hooks/web/useTable'\nimport { useI18n } from '@/hooks/web/useI18n'\nimport { Table, TableColumn } from '@/components/Table'\nimport { ElSwitch } from 'element-plus'\nimport { Search } from '@/components/Search'\nimport { FormSchema } from '@/components/Form'\nimport { ContentWrap } from '@/components/ContentWrap'\nimport Write from './components/Write.vue'\nimport AuthManage from './components/AuthManage.vue'\nimport { Dialog } from '@/components/Dialog'\nimport { DictDetail, selectDictLabel } from '@/utils/dict'\nimport { useDictStore } from '@/store/modules/dict'\nimport { BaseButton } from '@/components/Button'\n\ndefineOptions({\n  name: 'AuthRole'\n})\n\nconst { t } = useI18n()\n\nconst { tableRegister, tableState, tableMethods } = useTable({\n  fetchDataApi: async () => {\n    const { pageSize, currentPage } = tableState\n    const res = await getRoleListApi({\n      page: unref(currentPage),\n      limit: unref(pageSize),\n      ...unref(searchParams)\n    })\n    return {\n      list: res.data || [],\n      total: res.count || 0\n    }\n  },\n  fetchDelApi: async (value) => {\n    const res = await delRoleListApi(value)\n    return res.code === 200\n  }\n})\n\nconst { dataList, loading, total, pageSize, currentPage } = tableState\nconst { getList, delList } = tableMethods\n\nlet dataRangeOptions = ref<DictDetail[]>([])\n\nconst getOptions = async () => {\n  const dictStore = useDictStore()\n  const dictOptions = await dictStore.getDictObj(['sys_vadmin_data_range'])\n  dataRangeOptions.value = dictOptions.sys_vadmin_data_range\n}\n\ngetOptions()\n\nconst tableColumns = reactive<TableColumn[]>([\n  {\n    field: 'id',\n    label: '角色编号',\n    show: false,\n    disabled: false\n  },\n  {\n    field: 'name',\n    label: '角色名称',\n    show: true,\n    disabled: true\n  },\n  {\n    field: 'role_key',\n    label: '权限字符',\n    show: true\n  },\n  {\n    field: 'data_range',\n    label: '数据范围',\n    show: true,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return (\n          <>\n            <div>{selectDictLabel(unref(dataRangeOptions), row.data_range.toString())}</div>\n          </>\n        )\n      }\n    }\n  },\n  {\n    field: 'order',\n    label: '显示顺序',\n    show: true\n  },\n  {\n    field: 'disabled',\n    label: '角色状态',\n    show: true,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return (\n          <>\n            <ElSwitch modelValue={!row.disabled} disabled />\n          </>\n        )\n      }\n    }\n  },\n  {\n    field: 'is_admin',\n    label: '最高权限',\n    show: true,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return (\n          <>\n            <ElSwitch modelValue={row.is_admin} disabled />\n          </>\n        )\n      }\n    }\n  },\n  {\n    field: 'create_datetime',\n    label: '创建时间',\n    show: true\n  },\n  {\n    field: 'action',\n    width: '170px',\n    label: '操作',\n    show: true,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        const update = ['auth.role.update']\n        const del = ['auth.role.delete']\n        return (\n          <>\n            <BaseButton\n              v-show={row.id !== 1}\n              type=\"primary\"\n              v-hasPermi={update}\n              link\n              size=\"small\"\n              onClick={() => editAction(row)}\n            >\n              编辑\n            </BaseButton>\n            <BaseButton\n              v-show={row.id !== 1}\n              type=\"primary\"\n              link\n              size=\"small\"\n              onClick={() => authManageActive(row)}\n            >\n              权限管理\n            </BaseButton>\n            <BaseButton\n              v-show={row.id !== 1}\n              type=\"danger\"\n              v-hasPermi={del}\n              loading={delLoading.value}\n              link\n              size=\"small\"\n              onClick={() => delData(row)}\n            >\n              删除\n            </BaseButton>\n          </>\n        )\n      }\n    }\n  }\n])\n\nconst searchSchema = reactive<FormSchema[]>([\n  {\n    field: 'name',\n    label: '角色名称',\n    component: 'Input',\n    componentProps: {\n      clearable: false,\n      style: {\n        width: '214px'\n      }\n    }\n  },\n  {\n    field: 'role_key',\n    label: '权限字符',\n    component: 'Input',\n    componentProps: {\n      clearable: false,\n      style: {\n        width: '214px'\n      }\n    }\n  },\n  {\n    field: 'disabled',\n    label: '状态',\n    component: 'Select',\n    componentProps: {\n      style: {\n        width: '214px'\n      },\n      options: [\n        {\n          label: '正常',\n          value: false\n        },\n        {\n          label: '停用',\n          value: true\n        }\n      ]\n    }\n  }\n])\n\nconst searchParams = ref({})\nconst setSearchParams = (data: any) => {\n  currentPage.value = 1\n  searchParams.value = data\n  getList()\n}\n\nconst delLoading = ref(false)\n\nconst delData = async (row: any) => {\n  delLoading.value = true\n  await delList(true, [row.id]).finally(() => {\n    delLoading.value = false\n  })\n}\n\nconst authManageRef = ref<ComponentRef<typeof AuthManage>>()\n\n// 权限管理\nconst authManageActive = async (row: any) => {\n  const res = await getRoleApi(row.id)\n  if (res) {\n    res.data.data_range = res.data.data_range.toString()\n    currentRow.value = res.data\n    authManageRef.value?.openDrawer()\n  }\n}\n\nconst dialogVisible = ref(false)\nconst dialogTitle = ref('')\n\nconst currentRow = ref()\nconst actionType = ref('')\n\nconst writeRef = ref<ComponentRef<typeof Write>>()\n\nconst saveLoading = ref(false)\n\nconst editAction = async (row: any) => {\n  const res = await getRoleApi(row.id)\n  if (res) {\n    dialogTitle.value = '编辑角色'\n    actionType.value = 'edit'\n    res.data.data_range = res.data.data_range.toString()\n    currentRow.value = res.data\n    dialogVisible.value = true\n  }\n}\n\nconst addAction = () => {\n  dialogTitle.value = '新增角色'\n  actionType.value = 'add'\n  currentRow.value = undefined\n  dialogVisible.value = true\n}\n\nconst save = async () => {\n  const write = unref(writeRef)\n  const formData = await write?.submit()\n  if (formData) {\n    saveLoading.value = true\n    try {\n      const res = ref({})\n      if (actionType.value === 'add') {\n        res.value = await addRoleListApi(formData)\n        if (res.value) {\n          dialogVisible.value = false\n          getList()\n        }\n      } else if (actionType.value === 'edit') {\n        res.value = await putRoleListApi(formData)\n        if (res.value) {\n          dialogVisible.value = false\n          getList()\n        }\n      }\n    } finally {\n      saveLoading.value = false\n    }\n  }\n}\n</script>\n\n<template>\n  <ContentWrap>\n    <Search :schema=\"searchSchema\" @reset=\"setSearchParams\" @search=\"setSearchParams\" />\n    <Table\n      v-model:current-page=\"currentPage\"\n      v-model:page-size=\"pageSize\"\n      showAction\n      :columns=\"tableColumns\"\n      default-expand-all\n      node-key=\"id\"\n      :data=\"dataList\"\n      :loading=\"loading\"\n      :pagination=\"{\n        total\n      }\"\n      @register=\"tableRegister\"\n      @refresh=\"getList\"\n    >\n      <template #toolbar>\n        <ElRow :gutter=\"10\">\n          <ElCol :span=\"1.5\">\n            <BaseButton type=\"primary\" v-hasPermi=\"['auth.role.create']\" @click=\"addAction\"\n              >新增角色</BaseButton\n            >\n          </ElCol>\n        </ElRow>\n      </template>\n    </Table>\n  </ContentWrap>\n\n  <Dialog v-model=\"dialogVisible\" :title=\"dialogTitle\" :height=\"650\">\n    <Write ref=\"writeRef\" :current-row=\"currentRow\" />\n\n    <template #footer>\n      <BaseButton type=\"primary\" :loading=\"saveLoading\" @click=\"save\">\n        {{ t('exampleDemo.save') }}\n      </BaseButton>\n      <BaseButton @click=\"dialogVisible = false\">{{ t('dialogDemo.close') }}</BaseButton>\n    </template>\n  </Dialog>\n\n  <AuthManage ref=\"authManageRef\" :current-row=\"currentRow\" @get-list=\"getList\" />\n</template>\n"],"names":["t","useI18n","tableRegister","tableState","tableMethods","useTable","fetchDataApi","__async","pageSize","currentPage","res","getRoleListApi","__spreadValues","page","unref","limit","searchParams","list","data","total","count","fetchDelApi","value","delRoleListApi","code","dataList","loading","getList","delList","dataRangeOptions","ref","dictOptions","useDictStore","getDictObj","sys_vadmin_data_range","tableColumns","reactive","field","label","show","disabled","slots","default","row","_createVNode2","_Fragment2","selectDictLabel","data_range","toString","ElSwitch","is_admin","width","update","del","_withDirectives2","BaseButton","onClick","editAction","_createTextVNode2","_vShow","id","_resolveDirective2","authManageActive","delLoading","delData","searchSchema","component","componentProps","clearable","style","options","setSearchParams","finally","authManageRef","getRoleApi","currentRow","openDrawer","dialogVisible","dialogTitle","actionType","writeRef","saveLoading","addAction","undefined","save","write","formData","submit","addRoleListApi","putRoleListApi"],"mappings":"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"}