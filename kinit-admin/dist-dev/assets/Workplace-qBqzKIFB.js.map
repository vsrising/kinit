{"version":3,"file":"Workplace-qBqzKIFB.js","sources":["../../src/hooks/web/useTimeAgo.ts","../../src/components/Highlight/src/Highlight.vue","../../src/api/dashboard/workplace/index.ts","../../src/views/Dashboard/Workplace.vue"],"sourcesContent":["import { useTimeAgo as useTimeAgoCore, UseTimeAgoMessages } from '@vueuse/core'\nimport { computed, unref } from 'vue'\nimport { useLocaleStoreWithOut } from '@/store/modules/locale'\n\nconst TIME_AGO_MESSAGE_MAP: {\n  'zh-CN': UseTimeAgoMessages\n  en: UseTimeAgoMessages\n} = {\n  'zh-CN': {\n    justNow: '刚刚',\n    invalid: '无效时间',\n    past: (n) => (n.match(/\\d/) ? `${n}前` : n),\n    future: (n) => (n.match(/\\d/) ? `${n}后` : n),\n    month: (n, past) => (n === 1 ? (past ? '上个月' : '下个月') : `${n} 个月`),\n    year: (n, past) => (n === 1 ? (past ? '去年' : '明年') : `${n} 年`),\n    day: (n, past) => (n === 1 ? (past ? '昨天' : '明天') : `${n} 天`),\n    week: (n, past) => (n === 1 ? (past ? '上周' : '下周') : `${n} 周`),\n    hour: (n) => `${n} 小时`,\n    minute: (n) => `${n} 分钟`,\n    second: (n) => `${n} 秒`\n  },\n  en: {\n    justNow: '刚刚',\n    invalid: 'Invalid Date',\n    past: (n) => (n.match(/\\d/) ? `${n} ago` : n),\n    future: (n) => (n.match(/\\d/) ? `in ${n}` : n),\n    month: (n, past) =>\n      n === 1 ? (past ? 'last month' : 'next month') : `${n} month${n > 1 ? 's' : ''}`,\n    year: (n, past) =>\n      n === 1 ? (past ? 'last year' : 'next year') : `${n} year${n > 1 ? 's' : ''}`,\n    day: (n, past) => (n === 1 ? (past ? 'yesterday' : 'tomorrow') : `${n} day${n > 1 ? 's' : ''}`),\n    week: (n, past) =>\n      n === 1 ? (past ? 'last week' : 'next week') : `${n} week${n > 1 ? 's' : ''}`,\n    hour: (n) => `${n} hour${n > 1 ? 's' : ''}`,\n    minute: (n) => `${n} minute${n > 1 ? 's' : ''}`,\n    second: (n) => `${n} second${n > 1 ? 's' : ''}`\n  }\n}\n\nexport const useTimeAgo = (time: Date | number | string) => {\n  const localeStore = useLocaleStoreWithOut()\n\n  const currentLocale = computed(() => localeStore.getCurrentLocale)\n\n  const timeAgo = useTimeAgoCore(time, {\n    messages: TIME_AGO_MESSAGE_MAP[unref(currentLocale).lang]\n  })\n\n  return timeAgo\n}\n","<script lang=\"tsx\">\nimport { defineComponent, PropType, computed, h, unref } from 'vue'\nimport { propTypes } from '@/utils/propTypes'\n\nexport default defineComponent({\n  name: 'Highlight',\n  props: {\n    tag: propTypes.string.def('span'),\n    keys: {\n      type: Array as PropType<string[]>,\n      default: () => []\n    },\n    color: propTypes.string.def('var(--el-color-primary)')\n  },\n  emits: ['click'],\n  setup(props, { emit, slots }) {\n    const keyNodes = computed(() => {\n      return props.keys.map((key) => {\n        return h(\n          'span',\n          {\n            onClick: () => {\n              emit('click', key)\n            },\n            style: {\n              color: props.color,\n              cursor: 'pointer'\n            }\n          },\n          key\n        )\n      })\n    })\n\n    const parseText = (text: string) => {\n      props.keys.forEach((key, index) => {\n        const regexp = new RegExp(key, 'g')\n        text = text.replace(regexp, `{{${index}}}`)\n      })\n      return text.split(/{{|}}/)\n    }\n\n    const renderText = () => {\n      if (!slots?.default) return null\n      const node = slots?.default()[0].children\n\n      if (!node) {\n        return slots?.default()[0]\n      }\n\n      const textArray = parseText(node as string)\n      const regexp = /^[0-9]*$/\n      const nodes = textArray.map((t) => {\n        if (regexp.test(t)) {\n          return unref(keyNodes)[t] || t\n        }\n        return t\n      })\n      return h(props.tag, nodes)\n    }\n\n    return () => renderText()\n  }\n})\n</script>\n","import request from '@/config/axios'\nimport type { Project, Dynamic, Team, RadarData, Shortcuts } from './types'\n\nexport const getProjectApi = (): Promise<IResponse<Project>> => {\n  return request.get({ url: '/vadmin/workplace/project' })\n}\n\nexport const getDynamicApi = (): Promise<IResponse<Dynamic[]>> => {\n  return request.get({ url: '/vadmin/workplace/dynamic' })\n}\n\nexport const getTeamApi = (): Promise<IResponse<Team[]>> => {\n  return request.get({ url: '/vadmin/workplace/team' })\n}\n\nexport const getRadarApi = (): Promise<IResponse<RadarData[]>> => {\n  return request.get({ url: '/vadmin/workplace/radar' })\n}\n\nexport const getShortcutsApi = (): Promise<IResponse<Shortcuts[]>> => {\n  return request.get({ url: '/vadmin/workplace/shortcuts' })\n}\n","<script setup lang=\"ts\">\nimport { useTimeAgo } from '@/hooks/web/useTimeAgo'\nimport { ElRow, ElCol, ElSkeleton, ElCard, ElDivider, ElLink } from 'element-plus'\nimport { useI18n } from '@/hooks/web/useI18n'\nimport { ref, reactive, computed } from 'vue'\nimport { formatTime, getGreeting, getCurrentDate, getDayOfWeek } from '@/utils'\nimport { Highlight } from '@/components/Highlight'\nimport {\n  getProjectApi,\n  getDynamicApi,\n  getTeamApi,\n  getShortcutsApi\n} from '@/api/dashboard/workplace'\nimport type { Project, Dynamic, Team, Shortcuts } from '@/api/dashboard/workplace/types'\nimport avatar from '@/assets/imgs/avatar.jpg'\nimport { useAuthStore } from '@/store/modules/auth'\n\ndefineOptions({\n  name: 'DashboardWorkplace'\n})\n\nconst authStore = useAuthStore()\n\nconst loading = ref(true)\n\nconst toLink = (link: string) => {\n  window.open(link)\n}\n\nlet projects = reactive<Project[]>([])\n\n// 获取项目数\nconst getProject = async () => {\n  const res = await getProjectApi().catch(() => {})\n  if (res) {\n    projects = Object.assign(projects, res.data)\n  }\n}\n\nlet shortcuts = reactive<Shortcuts[]>([])\n\n// 获取快捷操作\nconst getShortcuts = async () => {\n  const res = await getShortcutsApi().catch(() => {})\n  if (res) {\n    shortcuts = Object.assign(shortcuts, res.data)\n  }\n}\n\ngetShortcuts()\n\n// 获取动态\nlet dynamics = reactive<Dynamic[]>([])\n\nconst getDynamic = async () => {\n  const res = await getDynamicApi().catch(() => {})\n  if (res) {\n    dynamics = Object.assign(dynamics, res.data)\n  }\n}\n\n// 获取团队\nlet team = reactive<Team[]>([])\n\nconst getTeam = async () => {\n  const res = await getTeamApi().catch(() => {})\n  if (res) {\n    team = Object.assign(team, res.data)\n  }\n}\n\nconst getAllApi = async () => {\n  await Promise.all([getProject(), getDynamic(), getTeam()])\n  loading.value = false\n}\n\ngetAllApi()\n\nconst { t } = useI18n()\n\nconst user = computed(() => authStore.getUser)\n</script>\n\n<template>\n  <div class=\"bg-[var(--app-content-bg-color)] flex-grow\">\n    <div>\n      <ElCard shadow=\"never\">\n        <ElSkeleton :loading=\"loading\" animated>\n          <ElRow :gutter=\"20\" justify=\"space-between\">\n            <ElCol :xl=\"12\" :lg=\"12\" :md=\"12\" :sm=\"24\" :xs=\"24\">\n              <div class=\"flex items-center\">\n                <img\n                  :src=\"user.avatar ? user.avatar : avatar\"\n                  alt=\"\"\n                  class=\"w-70px h-70px rounded-[50%] mr-20px\"\n                />\n                <div>\n                  <div class=\"text-20px\">\n                    {{ getGreeting() }}，{{ user.name }}，{{ t('workplace.happyDay') }}\n                  </div>\n                  <div class=\"mt-10px text-14px text-gray-500\">\n                    {{ getCurrentDate() }}，{{ getDayOfWeek() }}\n                  </div>\n                </div>\n              </div>\n            </ElCol>\n            <ElCol :xl=\"12\" :lg=\"12\" :md=\"12\" :sm=\"24\" :xs=\"24\">\n              <div class=\"flex h-70px items-center justify-end <sm:mt-20px\">\n                <div class=\"px-8px text-right\">\n                  <div class=\"text-14px text-gray-400 mb-20px\">最近登录时间</div>\n                  <span class=\"text-20px\">{{ user.last_login?.split(' ')[0] }}</span>\n                </div>\n              </div>\n            </ElCol>\n          </ElRow>\n        </ElSkeleton>\n      </ElCard>\n    </div>\n\n    <div class=\"mx-20px mt-20px\">\n      <ElRow :gutter=\"20\" justify=\"space-between\">\n        <ElCol :xl=\"16\" :lg=\"16\" :md=\"24\" :sm=\"24\" :xs=\"24\" class=\"mb-20px\">\n          <ElCard shadow=\"never\">\n            <template #header>\n              <div class=\"flex justify-between\">\n                <span>{{ t('workplace.project') }}</span>\n                <ElLink type=\"primary\" :underline=\"false\">{{ t('workplace.more') }}</ElLink>\n              </div>\n            </template>\n            <ElSkeleton :loading=\"loading\" animated>\n              <ElRow>\n                <ElCol\n                  v-for=\"(item, index) in projects\"\n                  :key=\"`card-${index}`\"\n                  :xl=\"8\"\n                  :lg=\"8\"\n                  :md=\"12\"\n                  :sm=\"24\"\n                  :xs=\"24\"\n                >\n                  <ElCard shadow=\"hover\">\n                    <div class=\"cursor-pointer\" @click=\"toLink(item.link)\">\n                      <div class=\"flex items-center\">\n                        <Icon :icon=\"item.icon\" :size=\"25\" class=\"mr-10px\" />\n                        <span class=\"text-16px\">{{ item.name }}</span>\n                      </div>\n                      <div class=\"mt-15px text-14px text-gray-400\">{{ t(item.message) }}</div>\n                      <div class=\"mt-20px text-12px text-gray-400 flex justify-between\">\n                        <span>{{ item.personal }}</span>\n                        <span>{{ formatTime(item.time, 'yyyy-MM-dd') }}</span>\n                      </div>\n                    </div>\n                  </ElCard>\n                </ElCol>\n              </ElRow>\n            </ElSkeleton>\n          </ElCard>\n\n          <ElCard shadow=\"never\" class=\"mt-20px\">\n            <template #header>\n              <div class=\"flex justify-between\">\n                <span>{{ t('workplace.dynamic') }}</span>\n                <ElLink type=\"primary\" :underline=\"false\">{{ t('workplace.more') }}</ElLink>\n              </div>\n            </template>\n            <ElSkeleton :loading=\"loading\" animated>\n              <div v-for=\"(item, index) in dynamics\" :key=\"`dynamics-${index}`\">\n                <div class=\"flex items-center\">\n                  <img\n                    src=\"@/assets/imgs/avatar.jpg\"\n                    alt=\"\"\n                    class=\"w-35px h-35px rounded-[50%] mr-20px\"\n                  />\n                  <div>\n                    <div class=\"text-14px\">\n                      <Highlight :keys=\"item.keys.map((v) => t(v))\">\n                        {{ t('workplace.pushCode') }}\n                      </Highlight>\n                    </div>\n                    <div class=\"mt-15px text-12px text-gray-400\">\n                      {{ useTimeAgo(item.time) }}\n                    </div>\n                  </div>\n                </div>\n                <ElDivider />\n              </div>\n            </ElSkeleton>\n          </ElCard>\n        </ElCol>\n        <ElCol :xl=\"8\" :lg=\"8\" :md=\"24\" :sm=\"24\" :xs=\"24\" class=\"mb-20px\">\n          <ElCard shadow=\"never\">\n            <template #header>\n              <span>{{ t('workplace.shortcutOperation') }}</span>\n            </template>\n            <ElSkeleton :loading=\"loading\" animated>\n              <ElCol\n                v-for=\"(item, index) in shortcuts\"\n                :key=\"`card-${index}`\"\n                :xl=\"12\"\n                :lg=\"12\"\n                :md=\"12\"\n                :sm=\"12\"\n                :xs=\"12\"\n                class=\"mb-10px\"\n              >\n                <ElLink type=\"primary\" :href=\"item.link\" target=\"_blank\" :underline=\"false\">\n                  {{ item.name }}\n                </ElLink>\n              </ElCol>\n            </ElSkeleton>\n          </ElCard>\n\n          <ElCard shadow=\"never\" class=\"mt-20px\">\n            <template #header>\n              <span>{{ t('workplace.team') }}</span>\n            </template>\n            <ElSkeleton :loading=\"loading\" animated>\n              <ElRow>\n                <ElCol v-for=\"item in team\" :key=\"`team-${item.name}`\" :span=\"12\" class=\"mb-20px\">\n                  <div class=\"flex items-center\">\n                    <Icon :icon=\"item.icon\" class=\"mr-10px\" />\n                    <ElLink type=\"default\" :underline=\"false\">\n                      {{ item.name }}\n                    </ElLink>\n                  </div>\n                </ElCol>\n              </ElRow>\n            </ElSkeleton>\n          </ElCard>\n        </ElCol>\n      </ElRow>\n    </div>\n  </div>\n</template>\n"],"names":["TIME_AGO_MESSAGE_MAP","n","past","useTimeAgo","time","localeStore","useLocaleStoreWithOut","currentLocale","computed","useTimeAgoCore","unref","defineComponent","name","props","tag","propTypes","string","def","keys","type","Array","default","color","emits","setup","emit","slots","keyNodes","map","key","h","onClick","style","cursor","parseText","text","forEach","index","regexp","RegExp","replace","split","renderText","node","children","textArray","nodes","t","test","getProjectApi","request","getDynamicApi","getTeamApi","getShortcutsApi","authStore","useAuthStore","loading","ref","toLink","link","projects","reactive","getProject","__async","res","shortcuts","dynamics","getDynamic","team","getTeam","useI18n","user"],"mappings":"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"}